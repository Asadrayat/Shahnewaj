{% assign id = section.id %}
{% liquid
  for block in section.blocks
    if block.type == 'category'
      assign categoryHandle = block.settings.title | handle
      capture categories
        echo categories
        echo '<div class="category" data-category="' | append: categoryHandle | append: '">'
        if block.settings.icon
        echo block.settings.icon 
        endif
        echo block.settings.title
        echo '</div>'
      endcapture
    endif
    if block.type == 'faq'
      assign faqCategoryHandle = block.settings.category | handle
      capture faqs
        echo faqs
        echo '<div class="faq" data-category="' | append: faqCategoryHandle | append: '"><div class="heading" id="heading_faq"><span class="icon">'
        render 'all-icons', name: 'plus'
        echo '</span><p class="faq_title"><span class="index__visible"></span>'
        echo block.settings.title
        echo '</p>'
        echo '</div><div class="faq_content" id= "faq_content">'
        echo block.settings.content
        echo '</div></div>'
      endcapture
    endif
  endfor
%}
<style>
    #shopify-section-{{ id }} {
     margin-top: {{ section.settings.margin_top }}px;
     margin-bottom: {{ section.settings.margin_bottom }}px;
     padding-top: {{ section.settings.padding_top }}px;
     padding-bottom: {{ section.settings.padding_bottom }}px;
     background: #FFCD80;
        h2.--section-title {
            color: #AF003A;
            /* font-family: var(--font-family-Title, "Neue Plak"); */
            font-size: 76px;
            margin: 0;
            font-weight: 500;
            text-align: center;
            /* line-height: var(--Line-Height-Heading-H2, 40px); */
            letter-spacing: 0;
            margin-bottom: 52px;
            /* margin-block: 0 var(--Spacing-Container-xxs); */
            @media(width < 768px) {
            font-size: 32px;
            margin-bottom: 32px;
            }        
            em {
                display: block;
                font-style: unset;
                @media(max-width: 768px) {
                    display: unset;
                }
            }
        }     
    }
    .container-{{ id }}{
        max-width: 1100px;
        margin: auto;
    }
    .custom-faq .faq_categories {
        display: flex;
        justify-content: center
        align-items: center;
        gap: 20px;
        margin-bottom: 48px;
      @media(max-width: 990px){
        overflow: scroll;
        scrollbar-width: none;
        width: 100%;
        justify-content: flex-start;
        align-items: flex-start;
        gap: 15px;
        margin-bottom: 24px;
      }
      .category{
        cursor: pointer;
        position: relative;
        font-size: 18px;
        line-height: 150%;
        color: #af003a;
        font-family: 'Lilita One';
        text-transform: uppercase;
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 24px;
        letter-spacing: 0;
        background: #fff;
        border-radius: 99px;     
        transition: all 0.4s ease-in;
        @media(max-width: 1200px){
            flex-wrap: nowrap;
            font-size: 14px;
            padding: 7px 14px;            
            min-width: max-content;
        }
      }
    }
    .faq {
        transition: all 0.8s ease-in-out;  
        border-radius: 32px;    
    }
    .faq.active.accordion__active-faq {
        background-color: #AF003A;
        color: #fff;
        padding: 28px;
        border-radius: 32px;
        display: block;
        transition: background-color 0.8s ease-in-out, 
              color 0.4s ease-in-out;
        @media(max-width: 768px) {
            padding: 14px;
            border-radius: 16px;
        }           
        .heading {
            padding: 0;
            border-radius: 0;
            background: inherit;            
        }
        p.faq_title {
          color: currentColor;
        }         
    }    
       
    .custom-faq .faq.active {
      display: block;
    }
     .custom-faq .faq {
      display: none;
      margin: 0 0 28px;
        @media(max-width: 768px) {
            margin: 0 0 14px;
        }           
      .heading {
        display: flex;
        justify-content: space-between;
        flex-direction: row-reverse;
        align-items: center;
        cursor: pointer;
        padding: 28px;
        background: #fff;
        border-radius: 32px;
        @media(max-width: 768px) {
            padding: 14px;
            border-radius: 16px;
        }        
        span.icon {
            line-height: 0;
            padding: 10px;
            background: #ffae42;
            border-radius: 99px;        
            @media(max-width: 768px) {
                padding: 5px;
            }                   
        }
        svg{
          transition: rotate 0.15s ease-in-out;
          fill: #000;
          width: 20px;
          height: 20px;
            @media(max-width: 768px) {
                width: 14px;
                height: 14px;
            }             
        }
      }
      p.faq_title{
        font-size: 40px;
        line-height: 140%;
        letter-spacing: 0;
        margin: 0;
        color: #af003a;
        font-family: 'Proxima';
        @media(max-width: 768px) {
           font-size: 16px; 
        }
      }
      .faq_content {
        max-height: 0;
        opacity: 0;
        overflow: hidden;
        transition: all 0.8s ease-in-out;
        color: #fff;
        line-height: 140%;
        font-size: 20px;
        margin: 12px 0 0;
        @media(max-width: 768px) {
           font-size: 16px; 
            padding-right: 16px;           
        }        
          p {
            margin: 0;
          }
          a{
            color: inherit;
          }
      }
    }
      .container-{{ id }} .category:hover,
      .container-{{ id }} .category.active{
        transition: all 0.8s ease-in-out;
        background: #af003a;
        color: #fff;
  }

  .container-{{ id }} .category:after{
      position: absolute;
      content: "";
      bottom: 0;
      left: 0;
      width: 0%;
      height: 1px;
      background: #0000005c; ;
      /* background: #0000005c; */
  }
  /* for js purpose.............................................. */
  .faq.active.accordion__active-faq .heading p{
    margin-bottom: 0;
  }
  .faq.active.accordion__active-faq #faq_content{
      max-height: auto;
      opacity: 1;
      transition: all 0.8s ease-in-out;
      overflow: hidden;
  }
  .faq.active.accordion__active-faq svg{
    rotate: 45deg;
    transition: all 0.4s ease-in-out;
  }
  /* for js purpose.............................................. */
  @media screen and (max-width: 890px){
     #shopify-section-{{ id }} {
       margin-top: {{ section.settings.margin_top-m }}px;
       margin-bottom: {{ section.settings.margin_bottom-m }}px;
       padding-top: {{ section.settings.padding_top-m }}px;
       padding-bottom: {{ section.settings.padding_bottom-m }}px;
    }
  }
</style>
<section class="custom-faq {% unless section.settings.full_width %}page-width{% endunless %}">
  <h2 class="--section-title">{{ section.settings.heading }}</h2>
  <div class="container-{{ id }}">
    <div class="faq_categories {% unless section.settings.show_tab_title %}hidden{% endunless %}">
      {{ categories }}
    </div>
    <div class="faq_container">
      {{ faqs }}
    </div>
  </div>
</section>

<script>
    // for tab content .....................................................
  document.addEventListener("DOMContentLoaded", function() {
    const categories = document.querySelectorAll('.category');
    const faqs = document.querySelectorAll('.faq');

    // Show the first category and its FAQs initially
    categories[0].classList.add('active');
    const initialCategory = categories[0].getAttribute('data-category');
    faqs.forEach(faq => {
      if (faq.getAttribute('data-category') === initialCategory) {
        faq.classList.add('active');
      }
    });
    const initialFaqs = document.querySelectorAll(`.faq.active[data-category="${initialCategory}"]`);
    initialFaqs.forEach((faq, i) => {
        const indexEl = faq.querySelector(".index__visible");
        if (indexEl) {
        const num = (i + 1).toString().padStart(2, "0");
        indexEl.textContent = `${num}. `;
        }
    });
    categories.forEach(category => {
      category.addEventListener('click', function() {
        const selectedCategory = category.getAttribute('data-category');

        // Hide all FAQs
        faqs.forEach(faq => {
          faq.classList.remove('active');
          if (faq.getAttribute('data-category') === selectedCategory) {
            faq.classList.add('active');
          }
        });

        // Handle active state for categories
        categories.forEach(c => {
          c.classList.remove('active');
        });
        category.classList.add('active');

        const visibleFaqs = document.querySelectorAll(`.faq.active[data-category="${selectedCategory}"]`);
        if (visibleFaqs.length > 0) {
        accordionsFaq.forEach(closeAccordionFaq); // close all first
        openAccordionFaq(visibleFaqs[0]);         // open the first visible one
        }        
        visibleFaqs.forEach((faq, i) => {
            const indexEl = faq.querySelector(".index__visible");
            if (indexEl) {
            // Format with leading zero
            const num = (i + 1).toString().padStart(2, "0");
            indexEl.textContent = `${num}. `;
            }
        });
      });
    });
  // for accordion................................................................
      var accordionsFaq = document.querySelectorAll(".faq");
      accordionsFaq.forEach(ac => console.log("height: ", ac.clientHeight))

      var openAccordionFaq = (accordion) => {
      	var content = accordion.querySelector("#faq_content");
      	accordion.classList.add("accordion__active-faq");
      	content.style.maxHeight = content.scrollHeight + 100 + "px";
      };

      var closeAccordionFaq = (accordion) => {
      	var content = accordion.querySelector("#faq_content");
      	accordion.classList.remove("accordion__active-faq");
      	content.style.maxHeight = null;
      };

      accordionsFaq.forEach((accordion) => {
      	var intro = accordion.querySelector("#heading_faq");
      	var content = accordion.querySelector("#faq_content");

      	intro.onclick = () => {
      		if (content.style.maxHeight) {
      			closeAccordionFaq(accordion);
      		} else {
      			accordionsFaq.forEach((accordion) => closeAccordionFaq(accordion));
      			openAccordionFaq(accordion);
      		}
      	};
      });
    // if you want to open 1st accordion by default
      if (accordionsFaq.length > 0) {
         openAccordionFaq(accordionsFaq[0]);
      }

   });
</script>

{% schema %}
{
  "name": "Faq Tab",
  "settings": [
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Full Width",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_tab_title",
      "label": "Show Tab Title",
      "default": true
    },
    {
        "type": "inline_richtext",
        "id": "heading",
        "label": "Heading",
        "default": "Shop By Shape"
    },    
    {
      "type": "range",
      "id": "margin_top",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Margin Top",
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Margin Bottom",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Padding Top",
      "default": 4
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 8
    },
    {
      "type": "header",
      "content": "Spacing (Mobile)"
    },
    {
      "type": "range",
      "id": "margin_top-m",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Margin Top (Mobile)",
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_bottom-m",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Margin Bottom (Mobile)",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_top-m",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Padding Top  (Mobile)",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom-m",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Padding Bottom  (Mobile)",
      "default": 0
    }
  ],
  "blocks": [
    {
      "type": "category",
      "name": "Category",
      "limit": 5,
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Category Name",
        },
        {
          "type": "liquid",
          "id": "icon",
          "label": "Category Icon",
        },
      ]
    },
    {
      "type": "faq",
      "name": "Faq",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content"
        },
        {
          "type": "text",
          "id": "category",
          "label": "Category block name"
        }
      ]
    }
  ],
  "presets":[
    {
      "name": "Faq Tab"
    }
  ]
}
{% endschema %}
